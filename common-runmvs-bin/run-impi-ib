EnvArg=                                                                                                                                        
for env in "${EnvCommandLine[@]}"  ; do
   var=${env%%=*}
   val=${env#*=}
   EnvArg="$EnvArg -genv $var $val"                                                                                                               
done   
EnvArg="$EnvArg -genv I_MPI_DEVICE rdssm"                                                                                                               

mpdconfdir=`pwd`
if ! [ -w "$mpdconfdir" ] ; then mpdconfdir=$HOME ; fi
if ! [ -w "$mpdconfdir" ] ; then mpdconfdir=~ ; fi
 
mpdconffile=`mktemp $mpdconfdir/mpdconfXXXXXX`
trap 'rm $mpdconffile ; exit 1' 0 1 2 15
echo "secretword=$RANDOM" >$mpdconffile
chmod 400 $mpdconffile 
export I_MPI_MPD_CONF=$mpdconffile
export I_MPI_DEVICE=${I_MPI_DEVICE:-rdssm}
export I_MPI_FALLBACK_DEVICE=${I_MPI_FALLBACK_DEVICE:-disable}
#export I_MPI_DAT_LIBRARY=${I_MPI_DAT_LIBRARY:-/usr/voltaire/lib/libdat.so}


$MPIRUN_HOME/mpdboot -n $numofnodes  -f $hosts_list --ordered --rsh=ssh
mpdtrace
  
$MPIRUN_HOME/mpiexec  $EnvArg -n $np  $progname $cmdLineArgs
